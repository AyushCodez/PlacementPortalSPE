apiVersion: batch/v1
kind: Job
metadata:
  name: seed-job
spec:
  template:
    spec:
      initContainers:
      - name: wait-for-mongo
        image: busybox
        command: ['sh', '-c', "until nc -z -v -w30 mongo 27017; do echo waiting for mongo; sleep 2; done"]
      containers:
      - name: seed
        image: local/auth-service:latest
        imagePullPolicy: IfNotPresent
        command: ["node", "seed_master.js"]
        env:
        - name: MONGO_URI
          value: mongodb://mongo:27017/spe_db
      restartPolicy: Never
  backoffLimit: 4
